{% extends "base.html" %}
{% block title %}Settings{% endblock %}

{% block content %}

<!-- Hero -->
<div class="settings-hero card">
  <div class="hero-row">
    <div class="hero-left">
      <div class="bot-bubble">{{ (settings.bot_name or 'B')[:1] }}</div>
      <div>
        <h1>Settings</h1>
        <p class="muted">Tune your bot‚Äôs identity, look & feel, and deployment targets.</p>
      </div>
    </div>
    <div class="hero-right">
      <a class="btn ghost" href="{{ url_for('dashboard') }}">‚Üê Back to Dashboard</a>
    </div>
  </div>
</div>

<form method="post" class="settings-grid">

  <!-- Identity -->
  <section class="card section">
    <div class="section-title">
      <span class="badge-pill gradient-blue">Identity</span>
      <h3>Bot name & theme</h3>
      <p class="muted">The name appears in Slack and in the dashboard header. Theme updates live.</p>
    </div>

    <div class="row grid-2">
      <div>
        <label class="label">Bot Name</label>
        <input class="input big" name="bot_name" value="{{ settings.bot_name or '' }}" placeholder="e.g., TeamBuddy" />
      </div>

      <div>
        <label class="label">Theme</label>
        <div class="segmented" role="tablist" id="theme-segmented">
          <label class="seg-item">
            <input type="radio" name="theme" value="Light" {% if (settings.theme or 'Light') == 'Light' %}checked{% endif %}>
            <span>‚òÄÔ∏è Light <b class="pill-check">‚úì</b></span>
          </label>
          <label class="seg-item">
            <input type="radio" name="theme" value="Dark" {% if settings.theme == 'Dark' %}checked{% endif %}>
            <span>üåô Dark <b class="pill-check">‚úì</b></span>
          </label>
          <label class="seg-item">
            <input type="radio" name="theme" value="Auto" {% if settings.theme == 'Auto' %}checked{% endif %}>
            <span>‚ú® Auto <b class="pill-check">‚úì</b></span>
          </label>
        </div>
        <div class="muted small" style="margin-top:6px;">‚ÄúAuto‚Äù follows your system preference.</div>
      </div>
    </div>
  </section>

  <!-- Deploy targets (CHIPS) -->
  <section class="card section">
    <div class="section-title">
      <span class="badge-pill gradient-purple">Deploy</span>
      <h3>Where should your bot live?</h3>
      <p class="muted">Enable one or more channels for weekly check-ins.</p>
    </div>

    <div class="chip-row">
      <label class="platform-chip">
        <input type="checkbox" name="deploy_slack" {% if settings.deploy_slack %}checked{% endif %}>
        <span class="chip-face">
          <span class="dot slack"></span>
          <span class="chip-text">Slack</span>
          <span class="chip-check" aria-hidden="true">‚úì</span>
        </span>
      </label>

      <label class="platform-chip">
        <input type="checkbox" name="deploy_discord" {% if settings.deploy_discord %}checked{% endif %}>
        <span class="chip-face">
          <span class="dot discord"></span>
          <span class="chip-text">Discord</span>
          <span class="chip-check" aria-hidden="true">‚úì</span>
        </span>
      </label>

      <label class="platform-chip">
        <input type="checkbox" name="deploy_email" {% if settings.deploy_email %}checked{% endif %}>
        <span class="chip-face">
          <span class="dot email"></span>
          <span class="chip-text">Email</span>
          <span class="chip-check" aria-hidden="true">‚úì</span>
        </span>
      </label>

      <label class="platform-chip">
        <input type="checkbox" name="deploy_web" {% if settings.deploy_web %}checked{% endif %}>
        <span class="chip-face">
          <span class="dot web"></span>
          <span class="chip-text">Web Dashboard</span>
          <span class="chip-check" aria-hidden="true">‚úì</span>
        </span>
      </label>
    </div>
  </section>

  <!-- Cadence (SEGMENTED RADIOS) -->
  <section class="card section">
    <div class="section-title">
      <span class="badge-pill gradient-green">Cadence</span>
      <h3>Meeting frequency</h3>
      <p class="muted">Pick the rhythm that fits your team.</p>
    </div>

    <div class="segmented big" role="tablist">
      <label class="seg-item">
        <input type="radio" name="meeting_frequency" value="Daily" {% if settings.meeting_frequency == 'Daily' %}checked{% endif %}>
        <span>üìÜ Daily <b class="pill-check">‚úì</b></span>
      </label>
      <label class="seg-item">
        <input type="radio" name="meeting_frequency" value="Weekly" {% if (settings.meeting_frequency or 'Weekly') == 'Weekly' %}checked{% endif %}>
        <span>üóìÔ∏è Weekly <b class="pill-check">‚úì</b></span>
      </label>
      <label class="seg-item">
        <input type="radio" name="meeting_frequency" value="Bi-weekly" {% if settings.meeting_frequency == 'Bi-weekly' %}checked{% endif %}>
        <span>‚è±Ô∏è Bi-weekly <b class="pill-check">‚úì</b></span>
      </label>
      <label class="seg-item">
        <input type="radio" name="meeting_frequency" value="Monthly" {% if settings.meeting_frequency == 'Monthly' %}checked{% endif %}>
        <span>üìÖ Monthly <b class="pill-check">‚úì</b></span>
      </label>
    </div>
  </section>

  <!-- Notifications -->
  <section class="card section">
    <div class="section-title">
      <span class="badge-pill gradient-orange">Notifications</span>
      <h3>Email summaries</h3>
      <p class="muted">Weekly rollups keep managers and stakeholders in the loop.</p>
    </div>

    <label class="toggle-cute">
      <input type="checkbox" name="notifications" {% if settings.notifications %}checked{% endif %}>
      <span class="track"><span class="thumb"></span></span>
      <span class="label">Enable weekly summary emails</span>
    </label>
  </section>

  <!-- Sticky footer -->
  <div class="save-bar">
    <button class="btn xl" type="submit">Save Settings</button>
  </div>
</form>

<style>
/* ===== Layout bits ===== */
.settings-hero{ padding:18px; margin-bottom:14px; border:1px solid var(--card-brd); background:var(--card); }
.hero-row{ display:flex; align-items:center; justify-content:space-between; gap:16px; }
.hero-left{ display:flex; align-items:center; gap:14px; }
.bot-bubble{
  width:44px;height:44px;border-radius:999px;display:flex;align-items:center;justify-content:center;
  font-weight:800;background:linear-gradient(180deg,#60a5fa,#34d399);color:#fff;box-shadow:0 6px 16px rgba(0,0,0,.10);
}
.settings-grid{ display:grid; gap:14px; }
.section{ padding:18px; }
.section-title{ margin-bottom:10px; }
.section-title h3{ margin:6px 0 4px; }
.badge-pill{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; font-weight:700; font-size:12px;
  color:#0b1220; border-radius:999px; background:#eef2f7; }
.gradient-blue{ background:linear-gradient(180deg,#dbeafe,#f0f9ff); }
.gradient-purple{ background:linear-gradient(180deg,#ede9fe,#f5f3ff); }
.gradient-green{ background:linear-gradient(180deg,#dcfce7,#ecfdf5); }
.gradient-orange{ background:linear-gradient(180deg,#ffedd5,#fff7ed); }

/* ===== Inputs / save bar ===== */
.input.big{ padding:14px; }
.save-bar{ position:sticky; bottom:10px; display:flex; justify-content:flex-end; margin-top:4px; }
.btn.ghost{ background:transparent; color:inherit; border:1px solid var(--card-brd); }
.btn.xl{ padding:14px 22px; font-size:16px; font-weight:800; }

/* ===== Deploy chips (checkbox) ===== */
.chip-row{ display:flex; gap:12px; flex-wrap:wrap; }
.platform-chip{ position:relative; display:inline-block; }
.platform-chip input{ position:absolute; opacity:0; pointer-events:none; }
.chip-face{
  display:inline-flex; align-items:center; gap:10px;
  padding:12px 14px; border:2px solid var(--card-brd); border-radius:14px;
  background:linear-gradient(180deg,#ffffff,#f8fafc);
  transition:transform .08s ease, box-shadow .15s ease, border-color .15s ease, background .15s ease;
  font-weight:800; letter-spacing:.1px;
}
.chip-text{ position:relative; top:0.5px; }
.chip-check{
  display:none; margin-left:4px; font-weight:900; color:#1e40af;
  background:#e0e7ff; border-radius:8px; padding:2px 6px; line-height:1;
}

/* Dot colors */
.dot{ width:10px; height:10px; border-radius:999px; display:inline-block; box-shadow:0 0 0 2px rgba(15,23,42,.06) inset; }
.dot.slack{ background:#4a154b; }
.dot.discord{ background:#5865F2; }
.dot.email{ background:#ef4444; }
.dot.web{ background:#2563eb; }

/* Selected state ‚Äî VERY visible */
.platform-chip:has(input:checked) .chip-face{
  border-color:#2563eb;
  background:linear-gradient(180deg,#e0e7ff,#ffffff);
  box-shadow:0 10px 26px rgba(37,99,235,.22);
  transform:translateY(-1px);
}
.platform-chip:has(input:checked) .chip-check{ display:inline-flex; }
.platform-chip .chip-face:focus-visible{
  outline:3px solid rgba(37,99,235,.35); outline-offset:3px;
}

/* ===== Segmented radios ===== */
.segmented{
  display:inline-flex; padding:6px; gap:6px; border-radius:14px;
  background:var(--bg); border:1px solid var(--card-brd);
}
.segmented.big{ padding:8px; }
.seg-item{ position:relative; }
.seg-item input{ position:absolute; opacity:0; inset:0; }
.seg-item span{
  display:inline-flex; align-items:center; gap:10px;
  padding:12px 16px; border-radius:12px; font-weight:900; letter-spacing:.1px;
  background:transparent; transition:all .15s ease; cursor:pointer;
  border:2px solid transparent;
}
.seg-item .pill-check{
  opacity:0; transform:scale(.8); transition:.15s;
  background:#e0e7ff; color:#1e40af; border-radius:999px; padding:2px 6px; line-height:1;
}
.seg-item input:checked + span{
  color:#0b1220; background:linear-gradient(180deg,#dbeafe,#ffffff);
  border-color:#2563eb; box-shadow:0 10px 26px rgba(37,99,235,.18);
  transform:translateY(-1px);
}
.seg-item input:checked + span .pill-check{ opacity:1; transform:scale(1); }
.seg-item input:focus-visible + span{ outline:3px solid rgba(37,99,235,.35); outline-offset:3px; }

/* ===== Cute toggle ===== */
.toggle-cute{ display:flex; align-items:center; gap:12px; }
.toggle-cute .track{
  --w:56px; --h:30px; position:relative; display:inline-block; width:var(--w); height:var(--h);
  background:#e5e7eb; border-radius:999px; box-shadow:inset 0 1px 2px rgba(0,0,0,.06); transition:.2s;
}
.toggle-cute .thumb{
  position:absolute; left:4px; top:4px; width:22px; height:22px; border-radius:999px; background:#fff;
  box-shadow:0 6px 16px rgba(0,0,0,.16); transition:.2s;
}
.toggle-cute input{ display:none; }
.toggle-cute input:checked + .track{ background:#22c55e; }
.toggle-cute input:checked + .track .thumb{ transform: translateX(26px); }
.toggle-cute .label{ font-weight:800; }

/* ===== Dark mode refinements ===== */
html.dark .settings-hero{ border-color:#1f2937; }
html.dark .segmented{ border-color:#1f2937; background:#0f1525; }
html.dark .seg-item input:checked + span{
  background:#0f1626; border-color:#3b82f6; box-shadow:0 12px 28px rgba(59,130,246,.25); color:#e5e7eb;
}
html.dark .platform-chip .chip-face{ background:#0f1525; border-color:#1f2937; box-shadow:none; color:#e5e7eb; }
html.dark .platform-chip:has(input:checked) .chip-face{
  background:#0f1626; border-color:#3b82f6; box-shadow:0 12px 28px rgba(59,130,246,.25);
}
html.dark .chip-check{ color:#bfdbfe; background:#1e293b; }
</style>

<script>
/* Theme segmented ‚Üî global theme sync (works with base.html's setTheme) */
(function(){
  const radios = document.querySelectorAll('#theme-segmented input[name="theme"]');
  radios.forEach(r => {
    r.addEventListener('change', (e) => {
      if (window.setTheme) window.setTheme(e.target.value);
    });
  });
})();
</script>

{% endblock %}
